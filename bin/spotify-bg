#!/bin/bash -xe
 
dir=$(dirname $0)

trackid=$($dir/spotify-controller getTrackId)
oldtrackid=''
if [[ -e /tmp/bg.info ]]; then
  oldtrackid=$(cat /tmp/bg.info)
fi
if [[ $trackid == $oldtrackid ]]; then
  exit 0
fi

image=$($dir/spotify-controller getAlbumUrl)
imagename=$(echo $image | sed "s/.*\/\([^\/]\)/\1/g")

if [[ -e /tmp/$imagename.jpg ]]; then
  exit 0
fi

echo -n $trackid > /tmp/bg.info
curl -s $image -o /tmp/$imagename.jpg

feh --bg-max /tmp/$imagename.jpg
